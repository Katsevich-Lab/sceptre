<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sceptre">
<title>Run quality control • sceptre</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run quality control">
<meta property="og:description" content="sceptre">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sceptre</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/sceptre.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/assign-grnas.html">Assign gRNAs</a>
    <a class="dropdown-item" href="../articles/import-data.html">Import data</a>
    <a class="dropdown-item" href="../articles/run-calibration-check.html">Run calibration check</a>
    <a class="dropdown-item" href="../articles/run-qc.html">Run quality control</a>
    <a class="dropdown-item" href="../articles/set-analysis-parameters.html">Set analysis parameters</a>
    <a class="dropdown-item" href="../articles/troubleshooting-and-faq.html">Troubleshooting and frequently asked questions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Katsevich-Lab/sceptre/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Run quality control</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Katsevich-Lab/sceptre/blob/HEAD/vignettes/run-qc.Rmd" class="external-link"><code>vignettes/run-qc.Rmd</code></a></small>
      <div class="d-none name"><code>run-qc.Rmd</code></div>
    </div>

    
    
<p>The fourth step of the pipeline is to run quality control (QC).</p>
<p><img src="pipeline_schematic_step_4.png" width="650px" style="display: block; margin: auto;"></p>
<p>We begin by loading the <code>sceptre</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Katsevich-Lab/sceptre" class="external-link">sceptre</a></span><span class="op">)</span></span></code></pre></div>
<p>We initialize <code>sceptre_object</code>s corresponding to the
high-MOI CRISPRi and low-MOI CRISPRko data. We call the first three
pipeline functions on both datasets: <code><a href="../reference/import_data.html">import_data()</a></code>,
<code><a href="../reference/set_analysis_parameters.html">set_analysis_parameters()</a></code>, and
<code><a href="../reference/assign_grnas.html">assign_grnas()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># low-MOI CRISPRko data</span></span>
<span><span class="co"># 1. import data</span></span>
<span><span class="va">sceptre_object_lowmoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span>response_matrix <span class="op">=</span> <span class="va">lowmoi_example_data</span><span class="op">$</span><span class="va">response_matrix</span>,</span>
<span>                                     grna_matrix <span class="op">=</span> <span class="va">lowmoi_example_data</span><span class="op">$</span><span class="va">grna_matrix</span>,</span>
<span>                                     extra_covariates <span class="op">=</span> <span class="va">lowmoi_example_data</span><span class="op">$</span><span class="va">extra_covariates</span>,</span>
<span>                                     grna_target_data_frame <span class="op">=</span> <span class="va">lowmoi_example_data</span><span class="op">$</span><span class="va">grna_target_data_frame</span>,</span>
<span>                                     moi <span class="op">=</span> <span class="st">"low"</span><span class="op">)</span></span>
<span><span class="va">positive_control_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/construct_positive_control_pairs.html">construct_positive_control_pairs</a></span><span class="op">(</span><span class="va">sceptre_object_lowmoi</span><span class="op">)</span></span>
<span><span class="va">discovery_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/construct_trans_pairs.html">construct_trans_pairs</a></span><span class="op">(</span>sceptre_object <span class="op">=</span> <span class="va">sceptre_object_lowmoi</span>,</span>
<span>                                         positive_control_pairs <span class="op">=</span> <span class="va">positive_control_pairs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2-3. set analysis parameters, assign gRNAs</span></span>
<span><span class="va">sceptre_object_lowmoi</span> <span class="op">&lt;-</span> <span class="va">sceptre_object_lowmoi</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_analysis_parameters.html">set_analysis_parameters</a></span><span class="op">(</span>discovery_pairs <span class="op">=</span> <span class="va">discovery_pairs</span>,</span>
<span>                          positive_control_pairs <span class="op">=</span> <span class="va">positive_control_pairs</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/assign_grnas.html">assign_grnas</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># high-MOI CRISPRi data</span></span>
<span><span class="co"># 1. import data</span></span>
<span><span class="va">sceptre_object_highmoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span>response_matrix <span class="op">=</span> <span class="va">highmoi_example_data</span><span class="op">$</span><span class="va">response_matrix</span>,</span>
<span>                                      grna_matrix <span class="op">=</span> <span class="va">highmoi_example_data</span><span class="op">$</span><span class="va">grna_matrix</span>,</span>
<span>                                      grna_target_data_frame <span class="op">=</span> <span class="va">grna_target_data_frame_highmoi</span>,</span>
<span>                                      moi <span class="op">=</span> <span class="st">"high"</span>,</span>
<span>                                      extra_covariates <span class="op">=</span> <span class="va">highmoi_example_data</span><span class="op">$</span><span class="va">extra_covariates</span>,</span>
<span>                                      response_names <span class="op">=</span> <span class="va">highmoi_example_data</span><span class="op">$</span><span class="va">gene_names</span><span class="op">)</span></span>
<span><span class="va">positive_control_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/construct_positive_control_pairs.html">construct_positive_control_pairs</a></span><span class="op">(</span><span class="va">sceptre_object_highmoi</span><span class="op">)</span></span>
<span><span class="va">discovery_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/construct_cis_pairs.html">construct_cis_pairs</a></span><span class="op">(</span><span class="va">sceptre_object_highmoi</span>,</span>
<span>                                       positive_control_pairs <span class="op">=</span> <span class="va">positive_control_pairs</span>,</span>
<span>                                       distance_threshold <span class="op">=</span> <span class="fl">5e6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2-3. set analysis parameters, assign gRNAs</span></span>
<span><span class="va">sceptre_object_highmoi</span> <span class="op">&lt;-</span> <span class="va">sceptre_object_highmoi</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_analysis_parameters.html">set_analysis_parameters</a></span><span class="op">(</span>discovery_pairs <span class="op">=</span> <span class="va">discovery_pairs</span>,</span>
<span>                          positive_control_pairs <span class="op">=</span> <span class="va">positive_control_pairs</span>,</span>
<span>                          side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/assign_grnas.html">assign_grnas</a></span><span class="op">(</span>parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We are now ready to run QC. We apply QC both at the level of the cell
and at the level of the target-response pair. Cellwise QC involves
filtering cells on the covariates <code>response_n_nonzero</code>,
<code>response_n_umis</code>, and <code>response_p_mito</code>. In
low-MOI we additionally remove cells that contain multiple gRNAs.
Pairwise QC involves removing pairs for which there are insufficiently
many cells or there is insufficiently high expression of the
response.</p>
<div class="section level2">
<h2 id="plot-the-cell-specific-covariates">Plot the cell-specific covariates<a class="anchor" aria-label="anchor" href="#plot-the-cell-specific-covariates"></a>
</h2>
<p>A helpful initial step in applying QC is to visualize the
distribution of the cell-specific covariates. To this end we call the
function <code><a href="../reference/plot_covariates.html">plot_covariates()</a></code>, which creates a histogram of
the covariates <code>response_n_nonzero</code>,
<code>response_n_umis</code>, and (if applicable)
<code>response_p_mito</code>. Cellwise QC removes cells that lie in the
extreme right tail of the <code>response_p_mito</code> distribution or
that lie in the extreme left <em>or</em> right tail of the
<code>response_n_nonzero</code> or <code>response_n_umis</code>
distribution. To help guide the selection of QC thresholds,
<code><a href="../reference/plot_covariates.html">plot_covariates()</a></code> plots candidate QC thresholds as vertical
lines on the histograms. The optional arguments
<code>response_n_nonzero_range</code>,
<code>response_n_umis_range</code>, and <code>p_mito_threshold</code>
control the location of these candidate QC thresholds.
<code>response_n_nonzero_range</code> (resp.,
<code>response_n_umis_range</code>) is a length-two vector of quantiles
(default: <code>c(0.01, 0.99)</code>) indicating the location at which
to draw candidate QC thresholds on the <code>response_n_nonzero</code>
(resp., <code>response_n_umis</code>) histogram. Next,
<code>p_mito_threshold</code> is a single numeric value in the interval
[0,1] specifying the location at which to draw a candidate QC threshold
on the <code>response_p_mito</code> plot. We call
<code><a href="../reference/plot_covariates.html">plot_covariates()</a></code> on the high-MOI CRISPRi
<code>sceptre_object</code> (i.e., <code>sceptre_object_highmoi</code>),
setting <code>p_mito_threshold</code> to <code>0.075</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_covariates.html">plot_covariates</a></span><span class="op">(</span><span class="va">sceptre_object_highmoi</span>, p_mito_threshold <span class="op">=</span> <span class="fl">0.075</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="plot_covariates_highmoi.png" alt="Plot of covariates for high-MOI CRISPRi data." width="650px"><p class="caption">
Plot of covariates for high-MOI CRISPRi data.
</p>
</div>
<p>Inspecting these plots (and tinkering with
<code>response_n_nonzero_range</code>,
<code>response_n_umis_range</code>, and <code>p_mito_threshold</code> as
necessary) helps guide the selection of reasonable QC thresholds. In
general it is good to clip long, asymmetric tails so as to remove
outlier cells. The QC thresholds appear to be drawn at sensible
locations on these data.</p>
<p>We also call <code><a href="../reference/plot_covariates.html">plot_covariates()</a></code> low-MOI CRISPRko data,
again setting <code>p_mito_threshold</code> to 0.075.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_covariates.html">plot_covariates</a></span><span class="op">(</span><span class="va">sceptre_object_lowmoi</span>, p_mito_threshold <span class="op">=</span> <span class="fl">0.075</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="plot_covariates_lowmoi.png" alt="Outcome of QC on low-MOI CRISPRko data." width="650px"><p class="caption">
Outcome of QC on low-MOI CRISPRko data.
</p>
</div>
<p>The low-MOI plot is broadly similar to its high-MOI counterpart. In
particular, the QC thresholds appear to be drawn at sensible
locations.</p>
</div>
<div class="section level2">
<h2 id="qc-parameters">QC parameters<a class="anchor" aria-label="anchor" href="#qc-parameters"></a>
</h2>
<p>We apply QC to a <code>sceptre_object</code> by calling the function
<code><a href="../reference/run_qc.html">run_qc()</a></code>. <code><a href="../reference/run_qc.html">run_qc()</a></code> takes the arguments
<code>sceptre_object</code>, <code>response_n_umis_range</code>,
<code>response_n_nonzero_range</code>, <code>p_mito_threshold</code>,
<code>additional_cells_to_remove</code>,
<code>n_nonzero_trt_thresh</code>, and
<code>n_nonzero_cntrl_thresh</code>. The only required argument among
these is <code>sceptre_object</code>; the rest are set to reasonable
defaults.</p>
<div class="section level3">
<h3 id="cellwise-qc-parameters">Cellwise QC parameters<a class="anchor" aria-label="anchor" href="#cellwise-qc-parameters"></a>
</h3>
<p>The parameters <code>response_n_umis_range</code>,
<code>response_n_nonzero_range</code>, <code>p_mito_threshold</code>,
and <code>additional_cells_to_remove</code> control cellwise QC.
<code>response_n_umis_range</code> (resp.,
<code>response_n_nonzero_range</code>) is a length-two vector of
quantiles (default <code>c(0.01, 0.99)</code>); cells whose
<code>response_n_umis</code> (resp., <code>response_n_nonzero</code>)
quantile falls outside this range are excluded. Next,
<code>p_mito_threshold</code> is a number in the interval [0,1]; cells
whose value for <code>response_p_mito</code> falls above this threshold
likewise are excluded. (Note that <code>p_mito_threshold</code> is not a
quantile but rather an absolute number). Finally,
<code>additional_cells_to_remove</code> is an integer vector specifying
the (1-based) indices of additional cells to remove. Cells flagged by
<code>additional_cells_to_remove</code> are removed before applying any
other cellwise QC filer.</p>
</div>
<div class="section level3">
<h3 id="pairwise-qc-parameters">Pairwise QC parameters<a class="anchor" aria-label="anchor" href="#pairwise-qc-parameters"></a>
</h3>
<p>The parameters <code>n_nonzero_trt_thresh</code> and
<code>n_nonzero_cntrl_thresh</code> control pairwise QC (i.e., QC at the
level of the target-response pair). Recall that for a given
target-response pair, we divide the cells into treatment and control
groups. The treatment group consists of the cells that contain a gRNA
targeting the given target, and the control group consists of the cells
against which the treatment cells are compared. (The control group can
be either the complement set or NT cells; this choice is governed by the
<code>control_group</code> parameter.) We define the “number of nonzero
treatment cells” (resp., the “number of nonzero control cells”) as the
number of cells in the treatment group (resp., control group) that
contain nonzero expression of the response. (We sometimes use the
shorthand <code>n_nonzero_trt</code> and <code>n_nonzero_cntrl</code> to
refer to the number of nonzero treatment cells and control cells,
respectively.) <code>n_nonzero_trt</code> and
<code>n_nonzero_cntrl</code> are reasonable metrics of pair quality,
with higher quality pairs exhibiting larger values for
<code>n_nonzero_trt</code> and <code>n_nonzero_cntrl</code>. The
schematic below illustrates the definition of <code>n_nonzero_trt</code>
and <code>n_nonzero_cntrl</code>.</p>
<div class="figure" style="text-align: center">
<img src="pairwise_qc_schematic.png" alt="Definition of `n_nonzero_trt` and `n_nonzero_cntrl`. Each square represents a cell, and the integer within a square represents the UMI count of the response in the corresponding cell. Some cells belong to the treatment group (blue), and others belong to the control group (red). `n_nonzero_trt` (resp., `n_nonzero_cntrl`) is the number of cells in the treatment group (resp., control group) with nonzero expression of the response." width="550px"><p class="caption">
Definition of <code>n_nonzero_trt</code> and
<code>n_nonzero_cntrl</code>. Each square represents a cell, and the
integer within a square represents the UMI count of the response in the
corresponding cell. Some cells belong to the treatment group (blue), and
others belong to the control group (red). <code>n_nonzero_trt</code>
(resp., <code>n_nonzero_cntrl</code>) is the number of cells in the
treatment group (resp., control group) with nonzero expression of the
response.
</p>
</div>
<p><code>sceptre</code> tabulates <code>n_nonzero_trt</code> and
<code>n_nonzero_cntrl</code> for each target-response pair. Pairs for
which <code>n_nonzero_trt</code> is less than
<code>n_nonzero_trt_thresh</code> or <code>n_nonzero_cntrl</code> is
less than <code>n_nonzero_cntrl_thresh</code> are excluded. Both
<code>n_nonzero_trt_thresh</code> and
<code>n_nonzero_cntrl_thresh</code> are set to <code>7</code> by
default.</p>
</div>
</div>
<div class="section level2">
<h2 id="run-qc">Run QC<a class="anchor" aria-label="anchor" href="#run-qc"></a>
</h2>
<p>We call <code><a href="../reference/run_qc.html">run_qc()</a></code> on <code>sceptre_object_highmoi</code>
and <code>sceptre_object_lowmoi</code> to run QC on the high-MOI CRISPRi
and low-MOI CRISPRko data. In both cases we set
<code>p_mito_threshold</code> to <code>0.075</code> but otherwise fall
back on the default parameter values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sceptre_object_highmoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_qc.html">run_qc</a></span><span class="op">(</span>sceptre_object <span class="op">=</span> <span class="va">sceptre_object_highmoi</span>,</span>
<span>                                 p_mito_threshold <span class="op">=</span> <span class="fl">0.075</span><span class="op">)</span></span>
<span><span class="va">sceptre_object_lowmoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_qc.html">run_qc</a></span><span class="op">(</span>sceptre_object <span class="op">=</span> <span class="va">sceptre_object_lowmoi</span>,</span>
<span>                                 p_mito_threshold <span class="op">=</span> <span class="fl">0.075</span><span class="op">)</span></span></code></pre></div>
<p>We can call the function <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on the resulting
<code>sceptre_object</code> to render a visualization of the outcome of
the QC step. We call <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on
<code>sceptre_object_lowmoi</code> as an example.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sceptre_object_lowmoi</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="plot_qc_lowmoi.png" alt="Outcome of applying cellwise (top) and pairwise (bottom) QC to the low-MOI CRISPRko data." width="500px"><p class="caption">
Outcome of applying cellwise (top) and pairwise (bottom) QC to the
low-MOI CRISPRko data.
</p>
</div>
<p>We described in Get Started (<code><a href="../articles/sceptre.html">vignette("sceptre")</a></code>) how to
interpret this figure. The top panel displays the percentage of cells
removed (vertical axis) as a result of applying the different cellwise
QC filters (horizontal axis). For example, over 20<span class="math inline">\(\%\)</span> of cells were removed because they
contain multiple gRNAs, and about 2<span class="math inline">\(\%\)</span> of cells were removed because they
exhibit extremely high or extremely values for
<code>response_n_nonzero</code>. Note that the “multiple gRNAs” filter
in general is applied only to low-MOI data. Next, the bottom panel plots
the set of discovery target-response pairs, where the vertical (resp.,
horizontal) position of a given pair indicates its
<code>n_nonzero_cntrl</code> (resp., <code>n_nonzero_trt</code>) value.
Pairs with a sufficiently large value for <code>n_nonzero_cntrl</code>
<em>and</em> <code>n_nonzero_trt</code> (colored in green) pass pairwise
QC; all other pairs are removed.</p>
<p>Finally, we call <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> on
<code>sceptre_object_lowmoi</code> to print a summary of the status of
the analysis. The summary contains information about cellwise and
pairwise QC; see the first entry under the “Attributes of the data”
field and the second two entries under the “Analysis parameters”
field.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sceptre_object_lowmoi</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class <span style="color: #0000BB;">sceptre_object</span>.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attributes of the data:</span></span>
<span><span class="co">##  • <span style="color: #0000BB;">20729</span> cells (<span style="color: #0000BB;">15348</span> after cellwise QC)</span></span>
<span><span class="co">##  • <span style="color: #0000BB;">299</span> responses</span></span>
<span><span class="co">##  • <span style="color: #0000BB;">Low</span> multiplicity-of-infection </span></span>
<span><span class="co">##  • <span style="color: #0000BB;">101</span> targeting gRNAs (distributed across <span style="color: #0000BB;">26</span> targets) </span></span>
<span><span class="co">##  • <span style="color: #0000BB;">9</span> non-targeting gRNAs </span></span>
<span><span class="co">##  • <span style="color: #0000BB;">6</span> covariates (bio_rep, grna_n_nonzero, grna_n_umis, response_n_nonzero, response_n_umis, response_p_mito)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Analysis status:</span></span>
<span><span class="co">##  <span style="color: #00BB00;">✓</span> import_data()</span></span>
<span><span class="co">##  <span style="color: #00BB00;">✓</span> set_analysis_parameters()</span></span>
<span><span class="co">##  <span style="color: #00BB00;">✓</span> assign_grnas()</span></span>
<span><span class="co">##  <span style="color: #00BB00;">✓</span> run_qc()</span></span>
<span><span class="co">##  <span style="color: #BB0000;">✗</span> run_calibration_check()</span></span>
<span><span class="co">##  <span style="color: #BB0000;">✗</span> run_power_check()</span></span>
<span><span class="co">##  <span style="color: #BB0000;">✗</span> run_discovery_analysis()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Analysis parameters: </span></span>
<span><span class="co">##  • Discovery pairs: data frame with <span style="color: #0000BB;">7765</span> pairs (<span style="color: #0000BB;">6205</span> after pairwise QC)</span></span>
<span><span class="co">##  • Positive control pairs: data frame with <span style="color: #0000BB;">9</span> pairs (<span style="color: #0000BB;">9</span> after pairwise QC)</span></span>
<span><span class="co">##  • Sidedness of test: <span style="color: #0000BB;">both</span></span></span>
<span><span class="co">##  • N nonzero treatment cells threshold: <span style="color: #0000BB;">7</span></span></span>
<span><span class="co">##  • N nonzero control cells threshold: <span style="color: #0000BB;">7</span></span></span>
<span><span class="co">##  • Control group: <span style="color: #0000BB;">non-targeting cells</span></span></span>
<span><span class="co">##  • Resampling mechanism: <span style="color: #0000BB;">permutations</span></span></span>
<span><span class="co">##  • gRNA grouping strategy: <span style="color: #0000BB;">union</span></span></span>
<span><span class="co">##  • Formula object: <span style="color: #0000BB;">log(response_n_nonzero) + log(response_n_umis) + bio_rep</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## gRNA-to-cell assignment information:</span></span>
<span><span class="co">##  • Assignment method: <span style="color: #0000BB;">maximum</span></span></span>
<span><span class="co">##  • Mean N cells per gRNA: <span style="color: #0000BB;">188.45</span></span></span>
<span><span class="co">##  • Mean N gRNAs per cell (MOI): not computed when using "maximum" assignment method</span></span></code></pre>
<p>Users may wonder why <code>sceptre</code> does not implement
response-wise QC (e.g., filtering out lowly expressed responses). The
reason is that pairwise QC is in some sense stronger than response-wise
QC. Suppose for example that a given response exhibits zero expression
across cells. Target-response pairs containing this response will have
an <code>n_nonzero_trt</code> and <code>n_nonzero_cntrl</code> value of
zero and thus be filtered out, in effect filtering out the response as
well.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Timothy Barry, Eugene Katsevich.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
