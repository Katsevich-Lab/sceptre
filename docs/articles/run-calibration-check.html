<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sceptre">
<title>Run calibration check • sceptre</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run calibration check">
<meta property="og:description" content="sceptre">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sceptre</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/sceptre.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/assign-grnas.html">Assign gRNAs</a>
    <a class="dropdown-item" href="../articles/import-data.html">Import data</a>
    <a class="dropdown-item" href="../articles/run-calibration-check.html">Run calibration check</a>
    <a class="dropdown-item" href="../articles/run-qc.html">Run quality control</a>
    <a class="dropdown-item" href="../articles/set-analysis-parameters.html">Set analysis parameters</a>
    <a class="dropdown-item" href="../articles/troubleshooting-and-faq.html">Troubleshooting and frequently asked questions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Katsevich-Lab/sceptre/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Run calibration check</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Katsevich-Lab/sceptre/blob/HEAD/vignettes/run-calibration-check.Rmd" class="external-link"><code>vignettes/run-calibration-check.Rmd</code></a></small>
      <div class="d-none name"><code>run-calibration-check.Rmd</code></div>
    </div>

    
    
<p>The fifth step of the pipeline is to run the calibration check. The
calibration check involves applying <code>sceptre</code> to analyze
negative control target-response pairs — pairs for which we know there
is no association between the target and response — to ensure control of
the false discovery rate.</p>
<p><img src="pipeline_schematic_step_5.png" width="650px" style="display: block; margin: auto;"></p>
<p>We begin by loading <code>sceptre</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Katsevich-Lab/sceptre" class="external-link">sceptre</a></span><span class="op">)</span></span></code></pre></div>
<p>We initialize <code>sceptre_object</code>s corresponding to the
low-MOI CRISPRko data and high-MOI CRISPRi data. We call the pipeline
functions that precede <code><a href="../reference/run_calibration_check.html">run_calibration_check()</a></code> (namely,
<code><a href="../reference/import_data.html">import_data()</a></code>, <code><a href="../reference/set_analysis_parameters.html">set_analysis_parameters()</a></code>,
<code><a href="../reference/assign_grnas.html">assign_grnas()</a></code>, and <code><a href="../reference/run_qc.html">run_qc()</a></code>) on both
datasets.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># low-MOI CRISPRko data</span></span>
<span><span class="co"># 1. import data</span></span>
<span><span class="va">sceptre_object_lowmoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span>response_matrix <span class="op">=</span> <span class="va">lowmoi_example_data</span><span class="op">$</span><span class="va">response_matrix</span>,</span>
<span>                                     grna_matrix <span class="op">=</span> <span class="va">lowmoi_example_data</span><span class="op">$</span><span class="va">grna_matrix</span>,</span>
<span>                                     extra_covariates <span class="op">=</span> <span class="va">lowmoi_example_data</span><span class="op">$</span><span class="va">extra_covariates</span>,</span>
<span>                                     grna_target_data_frame <span class="op">=</span> <span class="va">lowmoi_example_data</span><span class="op">$</span><span class="va">grna_target_data_frame</span>,</span>
<span>                                     moi <span class="op">=</span> <span class="st">"low"</span><span class="op">)</span></span>
<span><span class="va">positive_control_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/construct_positive_control_pairs.html">construct_positive_control_pairs</a></span><span class="op">(</span><span class="va">sceptre_object_lowmoi</span><span class="op">)</span></span>
<span><span class="va">discovery_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/construct_trans_pairs.html">construct_trans_pairs</a></span><span class="op">(</span>sceptre_object <span class="op">=</span> <span class="va">sceptre_object_lowmoi</span>,</span>
<span>                                         positive_control_pairs <span class="op">=</span> <span class="va">positive_control_pairs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2-4. set analysis parameters, assign gRNAs, run qc</span></span>
<span><span class="va">sceptre_object_lowmoi</span> <span class="op">&lt;-</span> <span class="va">sceptre_object_lowmoi</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_analysis_parameters.html">set_analysis_parameters</a></span><span class="op">(</span>discovery_pairs <span class="op">=</span> <span class="va">discovery_pairs</span>,</span>
<span>                          positive_control_pairs <span class="op">=</span> <span class="va">positive_control_pairs</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/assign_grnas.html">assign_grnas</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/run_qc.html">run_qc</a></span><span class="op">(</span>p_mito_threshold <span class="op">=</span> <span class="fl">0.075</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># high-MOI CRISPRi data</span></span>
<span><span class="co"># 1. import data</span></span>
<span><span class="va">sceptre_object_highmoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_data.html">import_data</a></span><span class="op">(</span>response_matrix <span class="op">=</span> <span class="va">highmoi_example_data</span><span class="op">$</span><span class="va">response_matrix</span>,</span>
<span>                                      grna_matrix <span class="op">=</span> <span class="va">highmoi_example_data</span><span class="op">$</span><span class="va">grna_matrix</span>,</span>
<span>                                      grna_target_data_frame <span class="op">=</span> <span class="va">grna_target_data_frame_highmoi</span>,</span>
<span>                                      moi <span class="op">=</span> <span class="st">"high"</span>,</span>
<span>                                      extra_covariates <span class="op">=</span> <span class="va">highmoi_example_data</span><span class="op">$</span><span class="va">extra_covariates</span>,</span>
<span>                                      response_names <span class="op">=</span> <span class="va">highmoi_example_data</span><span class="op">$</span><span class="va">gene_names</span><span class="op">)</span></span>
<span><span class="va">positive_control_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/construct_positive_control_pairs.html">construct_positive_control_pairs</a></span><span class="op">(</span><span class="va">sceptre_object_highmoi</span><span class="op">)</span></span>
<span><span class="va">discovery_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/construct_cis_pairs.html">construct_cis_pairs</a></span><span class="op">(</span><span class="va">sceptre_object_highmoi</span>,</span>
<span>                                       positive_control_pairs <span class="op">=</span> <span class="va">positive_control_pairs</span>,</span>
<span>                                       distance_threshold <span class="op">=</span> <span class="fl">5e6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2-4. set analysis parameters, assign gRNAs, run qc</span></span>
<span><span class="va">sceptre_object_highmoi</span> <span class="op">&lt;-</span> <span class="va">sceptre_object_highmoi</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_analysis_parameters.html">set_analysis_parameters</a></span><span class="op">(</span>discovery_pairs <span class="op">=</span> <span class="va">discovery_pairs</span>,</span>
<span>                          positive_control_pairs <span class="op">=</span> <span class="va">positive_control_pairs</span>,</span>
<span>                          side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/assign_grnas.html">assign_grnas</a></span><span class="op">(</span>parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/run_qc.html">run_qc</a></span><span class="op">(</span>p_mito_threshold <span class="op">=</span> <span class="fl">0.075</span><span class="op">)</span></span></code></pre></div>
<p>We are now ready to run the calibration check.</p>
<div class="section level2">
<h2 id="calibration-check-methodology">Calibration check methodology<a class="anchor" aria-label="anchor" href="#calibration-check-methodology"></a>
</h2>
<p>We begin by describing the methodology underlying the calibration
check.</p>
<div class="section level3">
<h3 id="differential-expression-paradigm">Differential expression paradigm<a class="anchor" aria-label="anchor" href="#differential-expression-paradigm"></a>
</h3>
<p>The goal of the calibration check is to test for association between
subsets of negative control gRNAs and responses. Suppose for simplicity
that we are conducting a singleton analysis, i.e. suppose that we seek
to test for association between an individual negative control gRNA and
a response. The “treatment group” is the set of cells containing the
given non-targeting gRNA, and the “control group” is the set of cells
against which the treatment group is compared to carry out the test of
association. The control group can be either the complement set or the
NT cells. Within the context of the calibration check analysis, the
complement set consists of the cells that do not contain the given
non-targeting gRNA; the NT cells, on the other hand, consist of the
cells that contain any non-targeting gRNA <em>excluding</em> the given
non-targeting gRNA that we are testing for association against the
response (see schematic below.) <code>sceptre</code> carries out the
test of association by testing for differential expression of the
response across the treatment and control groups, yielding a
p-value.</p>
<div class="figure" style="text-align: center">
<img src="control_vs_complement_undercover.png" alt="**Figure 1**: A schematic illustrating the differential expression paradigm of the calibration check analysis. The single-cell CRISPR screen experiment produces a pool of cells; in this example the cells contain targeting gRNAs and three different non-targeting gRNAs (labeled NT$_1$, NT$_2$, and NT$_3$). Suppose that we seek to test for association between a given non-targeting gRNA (e.g., NT$_2$) and a response. First, we divide the cells into treatment and control groups, where the treatment group consists of the cells that contain NT$_2$, and the control group can be either the complement set or the NT cells. Within the context of the calibration check analysis, the complement set consists of all cells that do not contain NT$_2$; the NT cells, on the other hand, consist of cells that contain a non-targeting gRNA excluding NT$_2$. (Thus, in this example, the NT cells consist of cells that contain NT$_1$ or NT$_3$.) `sceptre` tests for differential expression of the given response across the treatment and control groups, yielding a p-value for the test of association bewteen the given non-targeting gRNA and the response." width="750px"><p class="caption">
<strong>Figure 1</strong>: A schematic illustrating the differential
expression paradigm of the calibration check analysis. The single-cell
CRISPR screen experiment produces a pool of cells; in this example the
cells contain targeting gRNAs and three different non-targeting gRNAs
(labeled NT<span class="math inline">\(_1\)</span>, NT<span class="math inline">\(_2\)</span>, and NT<span class="math inline">\(_3\)</span>). Suppose that we seek to test for
association between a given non-targeting gRNA (e.g., NT<span class="math inline">\(_2\)</span>) and a response. First, we divide the
cells into treatment and control groups, where the treatment group
consists of the cells that contain NT<span class="math inline">\(_2\)</span>, and the control group can be either
the complement set or the NT cells. Within the context of the
calibration check analysis, the complement set consists of all cells
that do not contain NT<span class="math inline">\(_2\)</span>; the NT
cells, on the other hand, consist of cells that contain a non-targeting
gRNA excluding NT<span class="math inline">\(_2\)</span>. (Thus, in this
example, the NT cells consist of cells that contain NT<span class="math inline">\(_1\)</span> or NT<span class="math inline">\(_3\)</span>.) <code>sceptre</code> tests for
differential expression of the given response across the treatment and
control groups, yielding a p-value for the test of association bewteen
the given non-targeting gRNA and the response.
</p>
</div>
</div>
<div class="section level3">
<h3 id="constructing-the-negative-control-pairs">Constructing the negative control pairs<a class="anchor" aria-label="anchor" href="#constructing-the-negative-control-pairs"></a>
</h3>
<p>The calibration check involves forming a set of negative control
target-response pairs and then testing these pairs for association to
ensure control of the false discovery rate. <code>sceptre</code>
automatically constructs the negative control pairs, and it does so in
such a way that the negative control pairs are highly similar to the
discovery pairs, the difference being that the negative control pairs
are devoid of biological signal. <code>sceptre</code> builds the
negative control pairs as follows. First, <code>sceptre</code> forms
“negative control groups” by randomly grouping together distinct sets of
negative control gRNAs. For example, in a screen containing nine
negative control gRNAs (labeled NT<sub>1</sub><em>-</em>
NT<sub>9</sub>), gRNAs NT<sub>2</sub>, NT<sub>5</sub>, and
NT<sub>7</sub> might be assigned randomly to one group, gRNAs
NT<sub>3</sub>, NT<sub>6</sub>, and NT<sub>9</sub> might be assigned
randomly to another group, and so on. (See schematic below). The number
of negative control gRNAs per group (by default) is set equal to the
average number of gRNAs per discovery target. For example, in a screen
in which each discovery target is targeted by three gRNAs, each negative
control group is formed by randomly putting together three negative
control gRNAs. The negative control gRNA groups can (and often do)
overlap; for example, a given NT gRNA (e.g., NT<sub>2</sub>) could be a
part of multiple negative control groups.</p>
<div class="figure" style="text-align: center">
<img src="neg_control_pair_construction.png" alt="A schematic illustrating how the negative control target response pairs are constructed. First, negative control gRNA groups are formed by randomly assembling negative control gRNAs into groups of size one or more. Next, the negative control gRNA groups are randomly paired to responses. " width="550px"><p class="caption">
A schematic illustrating how the negative control target response pairs
are constructed. First, negative control gRNA groups are formed by
randomly assembling negative control gRNAs into groups of size one or
more. Next, the negative control gRNA groups are randomly paired to
responses.
</p>
</div>
<p>In a singleton analysis (i.e., an analysis in which we seek to test
for association between individual gRNAs and responses), each negative
control gRNA is placed into its own negative control group of size one.
(Recall that we can prompt <code>sceptre</code> to run a singleton
analysis by setting <code>grna_grouping_strategy</code> to
<code>"singleton"</code> in <code><a href="../reference/set_analysis_parameters.html">set_analysis_parameters()</a></code>). We
often use the term “negative control target” interchangeably with
“negative control gRNA group.”</p>
<p>After forming the negative control targets, <code>sceptre</code>
constructs the set of negative control pairs by randomly pairing the
negative control targets to the responses. The number of negative
control pairs that <code>sceptre</code> constructs is set equal to the
number of pairs in the discovery set (after QC is applied to the
discovery pairs). Moreover, the negative control pairs are subjected to
the same pairwise QC as the discovery pairs. In this sense the negative
control pairs are “matched” to the discovery pairs in three respects:
(1) the number of gRNAs contained within each target is the same across
the negative control and discovery pairs; (2) the negative control pairs
are subjected to the same pairwise QC as the discovery pairs; (3) the
number of negative control pairs is equal to the number of discovery
pairs.</p>
</div>
<div class="section level3">
<h3 id="analyzing-the-negative-control-pairs">Analyzing the negative control pairs<a class="anchor" aria-label="anchor" href="#analyzing-the-negative-control-pairs"></a>
</h3>
<p>Finally, <code>sceptre</code> tests for association between the
negative control targets and the responses to which the negative control
targets have been paired. If <code>grna_grouping_strategy</code> is set
to <code>"singleton"</code>, then the analysis proceeds as described in
the section “Differential expression paradigm.” If, on the other hand,
<code>grna_grouping_strategy</code> is set to <code>"union"</code> (the
default), then negative control gRNAs contained within a given negative
control target are combined via the union operation, and this combined
gRNA is tested for association against the responses as if it were a
singleton gRNA. Consider again Figure 1 (section “Differential
expression paradigm”). Suppose that NT<sub>1</sub> and NT<sub>2</sub>
constitute a given negative control target, and suppose we seek to test
for association between this negative control target and a given
response. In this case the “treatment cells” are those containing either
NT<sub>1</sub> or NT<sub>2</sub>. Meanwhile, the “complement set”
control group consists of cells that do <em>not</em> contain
NT<sub>1</sub> or NT<sub>2</sub>. Finally, the “NT cells” control gorup
consists of cells containing NT<sub>3</sub>.</p>
</div>
</div>
<div class="section level2">
<h2 id="carrying-out-the-calibration-check-and-obtaining-the-results">Carrying out the calibration check and obtaining the results<a class="anchor" aria-label="anchor" href="#carrying-out-the-calibration-check-and-obtaining-the-results"></a>
</h2>
<p>We carry out the calibration check by calling the function
<code><a href="../reference/run_calibration_check.html">run_calibration_check()</a></code> on the <code>sceptre_object</code>.
<code><a href="../reference/run_calibration_check.html">run_calibration_check()</a></code> takes the arguments
<code>sceptre_object</code> (required), <code>output_amount</code>
(optional), <code>n_calibration_pairs</code> (optional),
<code>calibration_group_size</code> (optional),
<code>print_progress</code> (optional), and <code>parallel</code>
(optional). <code>output_amount</code> is an integer (taking values 1,
2, or 3; default: <code>output_amount = 1</code>) specifying the amount
of output to return from <code><a href="../reference/run_calibration_check.html">run_calibration_check()</a></code>. We
describe <code>output_amount</code> in greater detail later. Next,
<code>n_calibration_pairs</code> is the number of negative control
target-response pairs to test for association. By default
<code>n_calibration_pairs</code> is set to the number of discovery
target-response pairs that passes pairwise QC.
<code>calibration_group_size</code> is the number of negative control
gRNAs to put together to construct each negative control target. By
default <code>calibration_group_size</code> is set to the median number
of gRNAs per discovery target. Finally, <code>print_progress</code> and
<code>parallel</code> control whether to print updates to the console
and run the computation in parallel, respectively.</p>
<p>We run the calibration check on the high-MOI CRISPRi and low-MOI
CRISPRko data, setting <code>parallel</code> to <code>TRUE</code> but
otherwise falling back on the default arguments.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sceptre_object_highmoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_calibration_check.html">run_calibration_check</a></span><span class="op">(</span><span class="va">sceptre_object_highmoi</span>,</span>
<span>                                                parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">sceptre_object_lowmoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_calibration_check.html">run_calibration_check</a></span><span class="op">(</span><span class="va">sceptre_object_lowmoi</span>,</span>
<span>                                               parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We can plot the outcome of the calibration check by calling
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on the resulting <code>sceptre_object</code>. Below,
we plot the outcome of the calibration check on the low-MOI CRISPRko
data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sceptre_object_lowmoi</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="plot_calibration_lowmoi.png" alt="Outcome of the calibration check on the low-MOI CRISPRko data." width="650px"><p class="caption">
Outcome of the calibration check on the low-MOI CRISPRko data.
</p>
</div>
<p>We described in the Get Started vignette
(<code><a href="../articles/sceptre.html">vignette("sceptre")</a></code>) how to interpret this figure.
Briefly, the upper left (resp., right) plot is a QQ plot of the negative
control p-values on an untransformed (resp., transformed) scale; the
p-values should lie predominantly along the diagonal line. The lower
left plot is a histogram of the estimated (log-2) fold changes; the
histogram should be symmetric and centered about zero. Finally, the
lower right panel is a text box displaying the number of false
discoveries made on the negative control pairs (after applying the
multiple testing adjustment) and the mean estimated (log-2) fold change.
Both of these numbers ideally are close to zero. (We emphasize that it
is OK if the number of false discoveries is nonzero; see subsequent
section.)</p>
<p>We can obtain a data frame containing the results by calling
<code>get_result</code> on the resulting <code>sceptre_object</code>,
setting <code>analysis</code> to <code>"run_calibration_check"</code>.
We obtain the data frame and print its first few rows below.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calibration_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_result.html">get_result</a></span><span class="op">(</span>sceptre_object <span class="op">=</span> <span class="va">sceptre_object_lowmoi</span>,</span>
<span>                                 analysis <span class="op">=</span> <span class="st">"run_calibration_check"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">calibration_result</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     response_id          grna_target n_nonzero_trt n_nonzero_cntrl pass_qc</span></span>
<span><span class="co">## 1:       SLC8B1  NTg4&amp;NTg7&amp;NTg8&amp;NTg9           236             162    TRUE</span></span>
<span><span class="co">## 2:       UBE2L6 NTg1&amp;NTg5&amp;NTg7&amp;NTg10           982             812    TRUE</span></span>
<span><span class="co">## 3:       TMEM37  NTg3&amp;NTg4&amp;NTg5&amp;NTg9            46              18    TRUE</span></span>
<span><span class="co">## 4:       PARPBP NTg3&amp;NTg8&amp;NTg9&amp;NTg10            51              61    TRUE</span></span>
<span><span class="co">## 5:       MTMR10 NTg1&amp;NTg3&amp;NTg8&amp;NTg10            87             250    TRUE</span></span>
<span><span class="co">## 6: RP11-799D4.4  NTg2&amp;NTg3&amp;NTg4&amp;NTg7            25              44    TRUE</span></span>
<span><span class="co">##         p_value log_2_fold_change significant</span></span>
<span><span class="co">## 1: 0.0000955005        0.23780413       FALSE</span></span>
<span><span class="co">## 2: 0.0003396914        0.05625781       FALSE</span></span>
<span><span class="co">## 3: 0.0004477911        0.56398692       FALSE</span></span>
<span><span class="co">## 4: 0.0010338764        0.53570790       FALSE</span></span>
<span><span class="co">## 5: 0.0010732514       -0.39425294       FALSE</span></span>
<span><span class="co">## 6: 0.0011500039       -0.64984993       FALSE</span></span></code></pre>
<p>Each row of this data frame corresponds to a negative control
target-response pair. (There are 6,205 rows in total, corresponding to
the 6,205 negative control target-response pairs that
<code>sceptre</code> constructed and tested for association.) The
columns <code>response_id</code> and <code>grna_target</code> indicate
the response and gRNA target that constitute a given pair. The
individual non-targeting gRNAs that make up a negative control target
are listed, concatenated into a string via the ampersand (“&amp;”)
separator. (For example, the negative control gRNA target
“NTg4&amp;NTg7&amp;NTg8&amp;NTg9” was formed by combining the negative
control gRNAs NTg4, NTg7, NTg8, and NTg9.) The remaining columns of the
data frame are <code>n_nonzero_trt</code> (i.e., the number of nonzero
treatment cells), <code>n_nonzero_cntrl</code> (i.e., the number of
nonzero control cells), <code>pass_qc</code> (i.e., whether the given
pair passes pairwise QC), <code>p_value</code> (i.e., the p-value of the
given pair), <code>log_2_fold_change</code> (i.e., the estimated log-2
fold change of the given pair), and <code>significant</code> (i.e.,
whether the pair is called as significant after applying the multiple
testing correction procedure).</p>
</div>
<div class="section level2">
<h2 id="improving-calibration">Improving calibration<a class="anchor" aria-label="anchor" href="#improving-calibration"></a>
</h2>
</div>
<div class="section level2">
<h2 id="changing-the-output_amount-argument">Changing the <code>output_amount</code> argument<a class="anchor" aria-label="anchor" href="#changing-the-output_amount-argument"></a>
</h2>
<p>The argument <code>output_amount</code> in
<code><a href="../reference/run_calibration_check.html">run_calibration_check()</a></code> controls the amount of information
contained within the output data frame. <code>output_amount</code> can
take values 1, 2, or 3 (default value 1). We again run the calibration
check on the high-MOI CRISPRi data, this time setting
<code>output_amount</code> to <code>2</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calibration_result_output_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_calibration_check.html">run_calibration_check</a></span><span class="op">(</span><span class="va">sceptre_object_highmoi</span>,</span>
<span>                                                     parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                                     output_amount <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_result.html">get_result</a></span><span class="op">(</span>analysis <span class="op">=</span> <span class="st">"run_calibration_check"</span><span class="op">)</span></span></code></pre></div>
<p>The resulting data frame contains the additional columns
<code>z_orig</code>, <code>stage</code>, <code>xi</code>,
<code>omega</code>, and <code>alpha</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calibration_result_output_2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">z_orig</span>, <span class="va">stage</span>, <span class="va">xi</span>, <span class="va">omega</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       z_orig stage         xi    omega      alpha</span></span>
<span><span class="co">## 1: -3.404460     2 -0.6503220 1.195424  0.9119020</span></span>
<span><span class="co">## 2: -2.494207     2 -0.6621881 1.193589  0.9361685</span></span>
<span><span class="co">## 3: -2.572771     2 -0.6336386 1.129223  0.7491185</span></span>
<span><span class="co">## 4: -2.543947     2  0.3705702 1.087020 -0.5132352</span></span>
<span><span class="co">## 5: -2.411835     2 -0.4010868 1.023403  0.4533119</span></span>
<span><span class="co">## 6: -2.341085     2 -0.6168560 1.189035  0.8471043</span></span></code></pre>
<p><code>z_orig</code> is the “original” z-score obtained by regressing
the response UMI count vector onto the raw (i.e., non-resampled) gRNA
indicator vector and covariate matrix. Next, <code>stage</code>
indicates the “stage” in which</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Timothy Barry, Eugene Katsevich.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
